<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🍫今日のおやつ占い🍩</title>
<style>
body{
  margin:0;
  font-family:"Hiragino Maru Gothic ProN",sans-serif;
  text-align:center;
  background:linear-gradient(135deg,#ffe4e1,#fff8dc,#ffe6f0);
}
.container{
  max-width:520px;
  margin:auto;
  padding:20px;
}
.card{
  background:white;
  padding:20px;
  border-radius:20px;
  box-shadow:0 0 20px #ffb6c1;
}
input,select{
  width:90%;
  padding:12px;
  margin:10px 0;
  border-radius:20px;
  border:2px solid #ffb6c1;
}
button{
  background:#ff69b4;
  color:white;
  padding:15px;
  border:none;
  border-radius:25px;
  font-size:18px;
  cursor:pointer;
}
#loading{
  font-size:22px;
  margin-top:20px;
  color:#ff1493;
}
#ad{
  margin-top:20px;
  padding:10px;
  background:#fff5e6;
  border-radius:15px;
  box-shadow:0 0 10px #ffd6b3;
}
</style>
</head>
<body>

<div class="container">
  <h1>🍫今日のおやつ占い🍩</h1>
  <div class="card">
    <input type="text" id="name" placeholder="名前">
    <input type="date" id="birth">
    <select id="gender">
      <option value="">性別（任意）</option>
      <option>男</option>
      <option>女</option>
      <option>選択しない</option>
    </select>
    <button id="fortuneBtn">占う</button>
  </div>

  <div id="loading"></div>

  <div id="ad">
    <p>スポンサー広告（ここに広告タグを入れる）</p>
  </div>
</div>

<script>
// ===== 実在おやつ100 =====
const snacks = [
"ポッキー","極細ポッキー","いちごポッキー","アーモンドポッキー",
"プリッツ","サラダプリッツ","トマトプリッツ",
"キットカット","オトナの甘さキットカット","抹茶キットカット",
"ブラックサンダー","白いブラックサンダー","ブラックサンダーミニ",
"チロルチョコ","きなこもちチロル","ミルクチロル","いちごチロル",
"じゃがりこサラダ","じゃがりこチーズ","じゃがりこ明太子",
"ポテトチップスうすしお","ポテトチップスコンソメ","ポテトチップスのり塩",
"堅あげポテト","ピザポテト","カラムーチョ","すっぱムーチョ",
"かっぱえびせん","サッポロポテト","おっとっと",
"きのこの山","たけのこの里","アポロ","コアラのマーチ",
"ハイチュウ","ハイチュウグレープ","ハイチュウソーダ",
"ガルボ","カントリーマアム","チョコパイ",
"エリーゼ","アルフォート","ルマンド",
"ビスコ","ムーンライト","源氏パイ",
"うまい棒コーンポタージュ","うまい棒チーズ","うまい棒めんたい",
"ベビースター","キャラメルコーン","ミルキー",
"ラムネ","果汁グミ","ピュレグミ",
"忍者めし","こんにゃくゼリー","ヨーグレット",
"ハイレモン","板チョコ","明治ミルクチョコ",
"ダース","LOOKチョコ","トッポ",
"クランキー","チョコボールピーナッツ","雪の宿",
"ばかうけ","歌舞伎揚","柿の種",
"たべっ子どうぶつ","マーブルチョコ","パイの実",
"ホームパイ","カプリコ","フルーツゼリー",
"どら焼き","ミニたい焼き","コンビニプリン",
"シュークリーム","エクレア","ロールケーキ",
"大福","みたらし団子","メロンパン",
"クリームパン","チョコスナックパン","ポップコーン",
"グラノーラバー","ナッツミックス","ビターチョコ",
"ホワイトチョコ","バナナチップス","おにぎりせんべい"
];

// ===== 実在飲み物100 =====
const drinks = [
"コカ・コーラ","コーラゼロ","ファンタオレンジ","ファンタグレープ",
"カルピス","カルピスソーダ","三ツ矢サイダー",
"メロンソーダ","ジンジャーエール",
"午後の紅茶ストレート","午後の紅茶ミルク","午後の紅茶レモン",
"リプトンミルクティー","抹茶ラテ","カフェオレ",
"ボスカフェオレ","缶コーヒー微糖","ブラックコーヒー",
"ポカリスエット","アクエリアス",
"いろはす","天然水","炭酸水",
"オレンジジュース","アップルジュース","グレープジュース",
"野菜ジュース","トマトジュース",
"ウーロン茶","緑茶","麦茶","ジャスミン茶",
"ほうじ茶","玄米茶",
"ココア","アイスココア","コーヒー牛乳",
"いちごミルク","バナナオレ",
"ヨーグルトドリンク","乳酸菌飲料",
"レモネード","はちみつレモン","スポーツドリンク",
"レッドブル","モンスターエナジー",
"フルーツティー","ピーチティー","レモンティー",
"黒烏龍茶","豆乳","調整豆乳",
"スムージーいちご","スムージーバナナ",
"ラムネ","冷やしあめ",
"抹茶ミルク","キャラメルラテ",
"カフェラテ","微糖コーヒー",
"炭酸レモン","炭酸グレープフルーツ",
"マンゴージュース","白ぶどうジュース",
"アロエドリンク","グリーンスムージー",
"紅茶花伝","ジャワティー",
"コーンポタージュ缶","おしるこ缶",
"ホットレモン","ホットミルク",
"ペットボトルコーヒー","甘酒",
"フルーツミックスジュース","梅ジュース",
"青りんごジュース","グァバジュース",
"パインジュース","ソルティライチ",
"ビタミンウォーター","レモンスカッシュ",
"ピーチネクター","ぶどうソーダ",
"オレンジスカッシュ","メッツコーラ",
"キレートレモン","MATCH",
"リアルゴールド","ミロ",
"ほろよい風炭酸（ノンアル）","豆乳バナナ"
];

// ===== メッセージ100 =====
const messages = [
"今日は無理しなくて大丈夫。",
"小さな一歩が未来を変える。",
"笑顔が運を引き寄せる。",
"焦らなくていい。",
"自分をちゃんと褒めて。",
"あなたならできる。",
"挑戦がチャンスを呼ぶ。",
"友達との時間を大切に。",
"今日は早めに休もう。",
"深呼吸でリセット。",
"好きなことを思い出して。",
"小さな幸せを見つけて。",
"失敗は成長のチャンス。",
"自分のペースで進もう。",
"努力はちゃんと実る。",
"今日はラッキーが近い。",
"前向きな言葉を使おう。",
"ありがとうを伝えてみて。",
"今のあなたで十分。",
"焦らずゆっくり。",
"未来は明るい。",
"今日もちゃんと頑張ってる。",
"あなたは一人じゃない。",
"勇気はもう持っている。",
"今日はチャンスの日。",
"自信を持って。",
"小さな成功を喜ぼう。",
"笑顔は最強の武器。",
"今日は挑戦デー。",
"無理しすぎないで。",
"優しさが運を呼ぶ。",
"あなたの個性は宝物。",
"今日は新しい発見がある。",
"ポジティブが鍵。",
"今日の努力は未来の味方。",
"好きな色を身につけて。",
"今を楽しもう。",
"きっと大丈夫。",
"笑顔で乗り越えよう。",
"小さな勇気が未来を変える。",
"今日は自分にご褒美。",
"直感を信じて。",
"焦りは手放そう。",
"心を軽くして。",
"今日は前進の日。",
"自分らしく輝こう。",
"今できることをやろう。",
"笑顔は連鎖する。",
"今日も応援してる。",
"小さな親切が幸運に。",
"明日はもっと良くなる。",
"今日の出会いを大切に。",
"あなたは強い。",
"自分を信じる日。",
"今日はポジティブデー。",
"諦めない心が鍵。",
"小さな変化が大きな未来。",
"今日は運が味方。",
"大丈夫、進んでる。",
"笑顔を忘れないで。",
"今日は深呼吸の日。",
"小さな幸せに気づいて。",
"未来は自分で作れる。",
"今日の選択が未来を変える。",
"今を大切に。",
"あなたの努力は本物。",
"今日はチャンスが来る。",
"好きなことに正直に。",
"今日も素敵な一日。",
"自分を好きでいよう。",
"今日は自信を持つ日。",
"優しさが未来を変える。",
"焦らなくていいよ。",
"今日はラッキーサインがある。",
"一歩踏み出そう。",
"今日の挑戦が宝物。",
"あなたは可能性の塊。",
"今日は運気上昇。",
"心配しなくていい。",
"今日の行動が鍵。",
"笑顔で過ごそう。",
"今日は自分時間を。",
"小さな前進でOK。",
"今日も生きてるだけで偉い。",
"未来は味方。",
"今日はいい日になる。",
"あなたは価値がある。",
"今日は勇気を出す日。",
"好きな音楽でリフレッシュ。",
"今日は笑顔デー。",
"自分を大切に。",
"今日はチャンス到来。",
"あなたなら乗り越えられる。",
"今日は安心していい。",
"未来は明るいよ。",
"今日も前進中。"
];

// ===== ハッシュ関数 =====
function hashCode(str){
  let hash=0;
  for(let i=0;i<str.length;i++){
    hash=((hash<<5)-hash)+str.charCodeAt(i);
    hash|=0;
  }
  return Math.abs(hash);
}

// ===== 10秒カウントダウン =====
function startFortune(){
  const name=document.getElementById("name").value;
  const birth=document.getElementById("birth").value;
  const gender=document.getElementById("gender").value;

  if(!name || !birth){
    alert("名前と生年月日を入力してください");
    return;
  }

  let count=10;
  const loading=document.getElementById("loading");
  loading.innerHTML="🔮 占い中... "+count+"秒";

  const timer=setInterval(()=>{
    count--;
    loading.innerHTML="🔮 占い中... "+count+"秒";
    if(count<=0){
      clearInterval(timer);
      loading.innerHTML="";
      openResult(name,birth,gender);
    }
  },1000);
}

// ボタンにイベント付与
document.getElementById("fortuneBtn").addEventListener("click", startFortune);

// ===== 新タブ表示（デコ機能付き） =====
function openResult(name,birth,gender){
  const today=new Date().toISOString().split("T")[0];
  const seed=hashCode(name+birth+gender+today);

  const snack=snacks[seed%100];
  const drink=drinks[(seed>>2)%100];
  const msg=messages[(seed>>3)%100];

  const newTab=window.open("","_blank");

  newTab.document.write(`
  <!DOCTYPE html>
  <html lang="ja">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>占い結果</title>
  <style>
    body{
      margin:0;
      font-family:"Hiragino Maru Gothic ProN",sans-serif;
      background:linear-gradient(135deg,#ff9a9e,#fad0c4,#fad0c4);
      text-align:center;
      overflow:hidden;
    }
    #captureArea{
      padding:30px;
      color:#fff;
    }
    h1{font-size:28px;}
    .result{font-size:22px;margin:15px;}
    canvas{
      position:fixed;
      top:0;
      left:0;
    }
    .toolbar{
      position:fixed;
      bottom:10px;
      left:50%;
      transform:translateX(-50%);
      background:white;
      padding:10px;
      border-radius:20px;
      box-shadow:0 0 10px rgba(0,0,0,0.2);
    }
    button,input{margin:5px;}
  </style>
  </head>
  <body>

  <div id="captureArea">
    <h1>🍫占い結果🍩</h1>
    <div class="result">🍪 ${snack}</div>
    <div class="result">🥤 ${drink}</div>
    <p>${msg}</p>
  </div>

  <canvas id="draw"></canvas>

  <div class="toolbar">
    <input type="color" id="color">
    <input type="range" id="size" min="1" max="20" value="5">
    <button onclick="eraser()">消しゴム</button>
    <button onclick="stamp('❤️')">❤️</button>
    <button onclick="stamp('⭐')">⭐</button>
    <button onclick="stamp('🍀')">🍀</button>
    <button onclick="clearCanvas()">クリア</button>
    <button onclick="download()">保存</button>
    <button onclick="share()">共有</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    const canvas=document.getElementById("draw");
    const ctx=canvas.getContext("2d");
    canvas.width=window.innerWidth;
    canvas.height=window.innerHeight;

    let drawing=false;
    let colorPicker=document.getElementById("color");
    let sizePicker=document.getElementById("size");

    canvas.addEventListener("mousedown",()=>drawing=true);
    canvas.addEventListener("mouseup",()=>drawing=false);
    canvas.addEventListener("mousemove",draw);

    function draw(e){
      if(!drawing)return;
      ctx.globalCompositeOperation="source-over";
      ctx.fillStyle=colorPicker.value;
      ctx.beginPath();
      ctx.arc(e.clientX,e.clientY,sizePicker.value,0,Math.PI*2);
      ctx.fill();
    }

    function eraser(){
      ctx.globalCompositeOperation="destination-out";
    }

    function stamp(icon){
      canvas.addEventListener("click",function handler(e){
        ctx.globalCompositeOperation="source-over";
        ctx.font="40px serif";
        ctx.fillText(icon,e.clientX,e.clientY);
        canvas.removeEventListener("click",handler);
      });
    }

    function clearCanvas(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
    }

    function download(){
      html2canvas(document.body).then(canvas=>{
        let link=document.createElement("a");
        link.download="fortune.png";
        link.href=canvas.toDataURL();
        link.click();
      });
    }

    function share(){
      if(navigator.share){
        navigator.share({
          title:"今日のおやつ占い",
          text:"今日のラッキーおやつは ${snack}！",
          url:location.href
        });
      }else{
        alert("スマホで共有できます");
      }
    }
  </script>

  </body>
  </html>
  `);

  newTab.document.close();
}
</script>

</body>
</html>
